恒定总和恒等式    $$x + y = D$$。

恒定乘积恒等式    $$x * y = k$$。

理想状态下，X、Y币种余额相等，即 $$x = y = D / 2$$ ，则乘积恒等式可以表示为：$$x * y = (D / 2)^2$$。

结合两种AMM的特点，Curve把两种恒等式整合成一个联合曲线，为了更灵活有效的调节恒等式的属性，给恒定总和恒等式添加因子χ，生成如下等式$$χ(x + y) + xy = χD + (D / 2)^2$$。χ是用来调节恒定总和恒等式影响占比的因子，值越大，则曲线越倾向于零滑点的直线，值越小，曲线更加倾向于高滑点的恒定乘积曲线。χ也被称之为杠杆，动态杠杆具备两个特性：

1. 自适应梯度，当流动池中各个代币的余额相等或者接近的时候，χ的值增大，降低滑点，反之值减小，增加曲线梯度，即曲线的价格，控制余额比例的偏离。
2. 与代币池中代币种类不相关，即与维度不相关。

上面提到的AMM的例子中，流动池中只有两种代币，即维度是2，为了使χ与维度无关，可以在恒定和的等式两边均乘以D，使得恒定和与恒定积有相同的维度，即$$Dχ(x + y) = D^2$$，则联合曲线的恒等式可以改为：

$$Dχ(x + y) + xy = χD^2 + D^2 / 2^2$$

接下来还要满足χ要能根据流动性池中代币之间的余额比例来自适应的变化，即各个代币余额越接近χ越大，反之越小，则可根据均值不等式的原理，即和一定时，各个因子相等时积最大，来定义一个χ的公式，如下：

$$χ =  \frac{Axy}{(D / 2)^2} $$

其中A是常数，即当x = y = D/2时，χ是一个常数，同时也是最大值，当代币之间的余额比例偏离平衡时，χ变小，而且偏离的越远，χ的值越小，这样就满足了动态杠杆需要的两个特性。最终获得的流动性池中只有两种代币的恒等式如下：

$$D\frac{Axy}{(D / 2)^2}(x + y) + xy = \frac{Axy}{(D / 2)^2}D^2 + \frac{D^2}{2^2}$$

即$$2^2A(x + y) + D = 2^2AD + \frac{D^3}{2^2xy}$$

以上例子都是二维空间的，即流动性池中只有两种代币，把以上共识扩展到n维空间，可以得出最终联合曲线恒等式：

$$An^{n}\sum{x_i} + D = ADn^n + \frac{D^{n+1}}{n^n\prod{x_i}}$$

在这个恒等式中，A的值是创建流动性池的时候选择的，恒定不变，D的值是在质押代币之后需进行计算，并且在swap过程中需要不断地进行迭代更新。







