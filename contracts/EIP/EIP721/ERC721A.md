# ERC721A

**主要是对一次mint多个NFT做了Gas优化。**



### 内容

ERC721，数据结构中对于每一个tokenID，都记录了其owner信息，逻辑清晰，但是也带来了数据冗余，批量mint的时候，连续几个tokenID的owner都是同一地址，必然在每一次设置都会消耗Gas。



ERC721A中，如果某一段连续的tokenID都被同一个用户拥有，那么只在第一个位置记录相关信息，会省去接下来的位置上设置信息而导致的Gas消耗。

如果我们想要查找 ID 为 N 的 NFT，直接查询到当前 owner 是 Alice。如果我们要查询 N + 2 的 NFT，此时相应的数据为空，那么就向前查找，直到找到第一个非空的数据位，就是对应的 owner 信息。这样就会带来一个问题，当我们想要查询 N + 3 的 owner 时，结果为空。我们按照前面的做法，向前查找第一个不为空的数据时，找到了 N + 2 的 Cindy，也就是说 N + 3 的 owner 现在变成了 Cindy！（N + 4 也是）。那么该如何解决这个问题呢，其实很简单，当发生转账行为时，将当前 ID 的后一个 ID 相关信息设置为转出人的信息。也就是说，再次显式设置一次 owner 信息。将 N + 3 的 owner 显式地设置成 Alice，这样在查找 N + 3 和 N + 4 的时候，owner 信息依然是正确的。



### 代码



### 实践

使用 [ERC721A 文档](https://github.com/chiru-labs/ERC721A#usage)中给出的示例代码进行测试。标准 ERC721 测试代码消耗了接近 30 万的 Gas，ERC721A 的代码只花费了将近 11 万的 Gas，节省了将近三分之二的 Gas。